#!/bin/bash
#
# sync_from - Synchronize current directory FROM a remote parent directory
#
# Usage: sync_from <remote_parent_dir>
#
# This script synchronizes the current working directory FROM a subdirectory
# of the remote parent directory. The subdirectory must have the same name
# as the current working directory's basename.
#
# Example:
#   cd /home/user/myproject
#   sync_from /backup
#   # Syncs FROM /backup/myproject TO /home/user/myproject

set -e  # Exit on error

# Check for correct number of arguments
if [ $# -ne 1 ]; then
    echo "Usage: sync_from <remote_parent_dir>" >&2
    echo "" >&2
    echo "Synchronizes current directory FROM <remote_parent_dir>/\$(basename \$PWD)" >&2
    echo "" >&2
    echo "Example:" >&2
    echo "  cd /home/user/myproject" >&2
    echo "  sync_from /backup" >&2
    echo "  # Syncs FROM /backup/myproject TO current directory" >&2
    exit 1
fi

REMOTE_PARENT="$1"
CURRENT_DIR="$(pwd)"
CURRENT_BASENAME="$(basename "$CURRENT_DIR")"
PARENT_DIR="$(dirname "$CURRENT_DIR")"

# Find the sync_dirs.py script
# Look in the same directory as this script, or in PATH
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SYNC_SCRIPT=""

if [ -f "$SCRIPT_DIR/sync_dirs.py" ]; then
    SYNC_SCRIPT="$SCRIPT_DIR/sync_dirs.py"
elif command -v sync_dirs.py &> /dev/null; then
    SYNC_SCRIPT="sync_dirs.py"
else
    echo "Error: Cannot find sync_dirs.py" >&2
    echo "Please ensure sync_dirs.py is in the same directory as this script or in your PATH" >&2
    exit 1
fi

echo "Synchronizing FROM: $REMOTE_PARENT/$CURRENT_BASENAME" >&2
echo "              TO: $CURRENT_DIR" >&2
echo "" >&2

# Execute the sync: source is remote subdirectory, destination is parent of current dir
python3 "$SYNC_SCRIPT" "$REMOTE_PARENT/$CURRENT_BASENAME" "$PARENT_DIR"
