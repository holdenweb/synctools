#!/bin/bash
#
# sync_to - Synchronize current directory TO a remote parent directory
#
# Usage: sync_to <remote_parent_dir>
#
# This script synchronizes the current working directory TO a subdirectory
# of the remote parent directory. The subdirectory will have the same name
# as the current working directory's basename.
#
# Example:
#   cd /home/user/myproject
#   sync_to /backup
#   # Syncs FROM /home/user/myproject TO /backup/myproject

set -e  # Exit on error

# Check for correct number of arguments
if [ $# -ne 1 ]; then
    echo "Usage: sync_to <remote_parent_dir>" >&2
    echo "" >&2
    echo "Synchronizes current directory TO <remote_parent_dir>/\$(basename \$PWD)" >&2
    echo "" >&2
    echo "Example:" >&2
    echo "  cd /home/user/myproject" >&2
    echo "  sync_to /backup" >&2
    echo "  # Syncs FROM current directory TO /backup/myproject" >&2
    exit 1
fi

REMOTE_PARENT="$1"
CURRENT_DIR="$(pwd)"

# Find the sync_dirs.py script
# Look in the same directory as this script, or in PATH
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SYNC_SCRIPT=""

if [ -f "$SCRIPT_DIR/sync_dirs.py" ]; then
    SYNC_SCRIPT="$SCRIPT_DIR/sync_dirs.py"
elif command -v sync_dirs.py &> /dev/null; then
    SYNC_SCRIPT="sync_dirs.py"
else
    echo "Error: Cannot find sync_dirs.py" >&2
    echo "Please ensure sync_dirs.py is in the same directory as this script or in your PATH" >&2
    exit 1
fi

echo "Synchronizing FROM: $CURRENT_DIR" >&2
echo "              TO: $REMOTE_PARENT/$(basename "$CURRENT_DIR")" >&2
echo "" >&2

# Execute the sync: source is current directory, destination is remote parent
python3 "$SYNC_SCRIPT" "$CURRENT_DIR" "$REMOTE_PARENT"
